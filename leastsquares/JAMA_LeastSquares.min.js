"use strict";var LeastSquares=function(){function LeastSquares(t,e,r=null,s=null){t.length!=e.length&&console.log("arrays must be the same length"),this.x=t,this.y=e,this.z=r,this.w=s}return LeastSquares.prototype.line=function(){for(var t=[],e=[],r=0;r<this.x.length;r++)t[r]=[],e[r]=[],e[r][0]=this.y[r],t[r][0]=this.x[r],t[r][1]=1;return t=new Matrix(t),e=new Matrix(e),t.solve(e)},LeastSquares.prototype.line3D=function(){var avg=[];avg[0]=eval(this.x.join("+"))/this.x.length,avg[1]=eval(this.y.join("+"))/this.y.length,avg[2]=eval(this.z.join("+"))/this.z.length;for(var A=[],i=0;i<this.x.length;i++)A[i]=[],A[i][0]=this.x[i]-avg[0],A[i][1]=this.y[i]-avg[1],A[i][2]=this.z[i]-avg[2];A=new Matrix(A);var res=A.svd();console.log(res.V);for(var out=[],i=0;i<3;i++)out[i]=[],out[i][0]=avg[i],out[i][1]=res.V[i][0];return new Matrix(out)},LeastSquares.prototype.plane=function(){for(var t=[],e=[],r=0;r<this.x.length;r++)t[r]=[],e[r]=[],t[r][0]=this.x[r],t[r][1]=this.y[r],t[r][2]=1,e[r][0]=this.z[r];return t=new Matrix(t),e=new Matrix(e),t.solve(e)},LeastSquares.prototype.parab=function(){for(var t=[],e=[],r=0;r<this.x.length;r++)t[r]=[],e[r]=[],e[r][0]=this.y[r],t[r][2]=1,t[r][1]=this.x[r],t[r][0]=this.x[r]*t[r][1];return t=new Matrix(t),e=new Matrix(e),t.solve(e)},LeastSquares.prototype.poly=function(t){for(var e=[],r=[],s=0;s<this.x.length;s++){e[s]=[],r[s]=[],r[s][0]=this.y[s];for(var i=t-(e[s][t]=1);0<=i;i--)e[s][i]=this.x[s]*e[s][i+1]}return e=new Matrix(e),r=new Matrix(r),e.solve(r)},LeastSquares.prototype.poly2D=function(t,e,r=-1){for(var s=[],i=[],a=Math.max(t,e),n=0;n<this.x.length;n++){s[n]=[],i[n]=[];for(var o=0,l=1,h=0;h<=t;h++){for(var x=1,p=0;p<=e;p++)h+p<=a&&(s[n][o++]=l*x),x*=this.y[n];l*=this.x[n]}i[n][0]=this.z[n]}s=new Matrix(s),i=new Matrix(i);var u=s.solve(i);if(-1!=r){for(var c=[],l="",h=0;h<=t;h++){x="";for(p=0;p<=e;p++)h+p<=a&&(h+p==0?c.push("C"):c.push(l+x)),x+="y";l+="x"}for(var f=0;f<c.length;f++)r[c[f]]=u.A[f][0]}return u},LeastSquares.prototype.poly3D=function(t,e,r,s=-1){if(null==this.z)return console.log("ERROR: No Z Data, cannot compute 3D polynomial"),null;if(null==this.w){console.log("WARNING: No W Data, setting all W values to 1."),this.w=[];for(var i=0;i<this.x.length;i++)this.w.push(1)}for(var a=[],n=[],o=Math.max(Math.max(t,e),r),i=0;i<this.x.length;i++){a[i]=[],n[i]=[];for(var l=0,h=1,x=0;x<=t;x++){for(var p=1,u=0;u<=e;u++){for(var c=1,f=0;f<=r;f++)x+u+f<=o&&(a[i][l++]=h*p*c),c*=this.z[i];p*=this.y[i]}h*=this.x[i]}n[i][0]=this.w[i]}a=new Matrix(a),n=new Matrix(n);var y=a.solve(n);if(-1!=s){for(var v=[],h="",x=0;x<=t;x++){p="";for(u=0;u<=e;u++){c="";for(f=0;f<=r;f++)x+u+f<=o&&(x+u+f==0?v.push("C"):v.push(h+p+c)),c+="z";p+="y"}h+="x"}for(var g=0;g<v.length;g++)s[v[g]]=y.A[g][0]}return y},LeastSquares.prototype.log=function(){for(var t=[],e=[],r=0;r<this.x.length;r++)t[r]=[],e[r]=[],e[r][0]=this.y[r],t[r][0]=Math.log(this.x[r]),t[r][1]=1;return t=new Matrix(t),e=new Matrix(e),t.solve(e)},LeastSquares.prototype.powLin=function(){for(var t=[],e=[],r=0;r<this.x.length;r++)t[r]=[],e[r]=[],e[r][0]=Math.log(this.y[r]),t[r][0]=Math.log(this.x[r]),t[r][1]=1;t=new Matrix(t),e=new Matrix(e);var s=t.solve(e);return s.A[1][0]=Math.exp(s.A[1][0]),s},LeastSquares.prototype.expLin=function(){for(var t=[],e=[],r=0;r<this.x.length;r++)t[r]=[],e[r]=[],e[r][0]=Math.log(this.y[r]),t[r][0]=this.x[r],t[r][1]=1;t=new Matrix(t),e=new Matrix(e);var s=t.solve(e);return s.A[1][0]=Math.exp(s.A[1][0]),s},LeastSquares.prototype.sinLinFreq=function(t,e=1,r=e){for(var s=[],i=[],a=0;a<this.x.length;a++){s[a]=[],i[a]=[],i[a][0]=this.y[a];for(var n=e,o=t-(s[a][t]=1);0<=o;o--)s[a][o]=Math.sin(this.x[a]*n),n+=r}return s=new Matrix(s),i=new Matrix(i),s.solve(i)},LeastSquares.prototype.cosLinFreq=function(t,e=1,r=e){for(var s=[],i=[],a=0;a<this.x.length;a++){s[a]=[],i[a]=[],i[a][0]=this.y[a];for(var n=e,o=t-(s[a][t]=1);0<=o;o--)s[a][o]=Math.cos(this.x[a]*n),n+=r}return s=new Matrix(s),i=new Matrix(i),s.solve(i)},LeastSquares.prototype.sinCosLinFreq=function(t,e=1,r=e){for(var s=[],i=[],a=0;a<this.x.length;a++){s[a]=[],i[a]=[],i[a][0]=this.y[a];for(var n=e,o=2*t-(s[a][2*t]=1);0<=o;o-=2)s[a][o]=Math.sin(this.x[a]*n),s[a][o-1]=Math.cos(this.x[a]*n),n+=r}return s=new Matrix(s),i=new Matrix(i),s.solve(i)},LeastSquares.prototype.sinExpFreq=function(t,e=1,r=2){for(var s=[],i=[],a=0;a<this.x.length;a++){s[a]=[],i[a]=[],i[a][0]=this.y[a];for(var n=e,o=t-(s[a][t]=1);0<=o;o--)s[a][o]=Math.sin(this.x[a]*n),n*=r}return s=new Matrix(s),i=new Matrix(i),s.solve(i)},LeastSquares.prototype.cosExpFreq=function(t,e=1,r=2){for(var s=[],i=[],a=0;a<this.x.length;a++){s[a]=[],i[a]=[],i[a][0]=this.y[a];for(var n=e,o=t-(s[a][t]=1);0<=o;o--)s[a][o]=Math.cos(this.x[a]*n),n*=r}return s=new Matrix(s),i=new Matrix(i),s.solve(i)},LeastSquares.prototype.sinCosExpFreq=function(t,e=1,r=2){for(var s=[],i=[],a=0;a<this.x.length;a++){s[a]=[],i[a]=[],i[a][0]=this.y[a];for(var n=e,o=2*t-(s[a][2*t]=1);0<=o;o-=2)s[a][o]=Math.sin(this.x[a]*n),s[a][o-1]=Math.cos(this.x[a]*n),n*=r}return s=new Matrix(s),i=new Matrix(i),s.solve(i)},LeastSquares.prototype.sinCos2DLinFreq=function(t,e,r=[1,1],s=[1,1]){for(var i=[],a=[],n=0;n<this.x.length;n++){i[n]=[],a[n]=[],a[n][0]=this.z[n],i[n][0]=1;for(var o=r.slice(),l=1,h=0;h<t;h++)i[n][l++]=Math.sin(this.x[n]*o[0]),i[n][l++]=Math.cos(this.x[n]*o[0]),o[0]+=s[0];for(var x=0;x<e;x++)i[n][l++]=Math.sin(this.y[n]*o[1]),i[n][l++]=Math.cos(this.y[n]*o[1]),o[1]+=s[1]}return i=new Matrix(i),a=new Matrix(a),i.solve(a)},LeastSquares.prototype.sinCos2DExpFreq=function(t,e,r=[1,1],s=[2,2]){for(var i=[],a=[],n=0;n<this.x.length;n++){i[n]=[],a[n]=[],a[n][0]=this.z[n],i[n][0]=1;for(var o=r.slice(),l=1,h=0;h<t;h++)i[n][l++]=Math.sin(this.x[n]*o[0]),i[n][l++]=Math.cos(this.x[n]*o[0]),o[0]*=s[0];for(var x=0;x<e;x++)i[n][l++]=Math.sin(this.y[n]*o[1]),i[n][l++]=Math.cos(this.y[n]*o[1]),o[1]*=s[1]}return i=new Matrix(i),a=new Matrix(a),i.solve(a)},LeastSquares.prototype.ellipse=function(){},LeastSquares.prototype.ellipseGen=function(t=-1,e=5){return 0==e?this.ellipseGenA(t):1==e?this.ellipseGenB(t):2==e?this.ellipseGenC(t):3==e?this.ellipseGenD(t):4==e?this.ellipseGenE(t):this.ellipseGenF(t)},LeastSquares.prototype.ellipseGenA=function(t=-1){for(var e=[],r=[],s=0;s<this.x.length;s++)e[s]=[],r[s]=[],e[s][4]=1,e[s][3]=this.y[s],e[s][2]=this.x[s],e[s][1]=this.y[s]*this.y[s],e[s][0]=this.x[s]*this.y[s],r[s][0]=-this.x[s]*this.x[s];e=new Matrix(e),r=new Matrix(r);var i=e.solve(r),a=[];a[0]=[];for(s=a[0][0]=1;s<6;s++)a[s]=[],a[s][0]=i.A[s-1][0];return this.returnEllipse(a,t)},LeastSquares.prototype.ellipseGenB=function(t=-1){for(var e=[],r=[],s=0;s<this.x.length;s++)e[s]=[],r[s]=[],e[s][4]=1,e[s][3]=this.y[s],e[s][2]=this.x[s],e[s][1]=this.y[s]*this.y[s],e[s][0]=this.x[s]*this.x[s],r[s][0]=-this.x[s]*this.y[s];e=new Matrix(e),r=new Matrix(r);for(var i=e.solve(r),a=[],s=0;s<5;s++)0==s?(a[s]=[],a[s][0]=i.A[s][0]):(a[s+1]=[],a[s+1][0]=i.A[s][0]);return a[1]=[],a[1][0]=1,this.returnEllipse(a,t)},LeastSquares.prototype.ellipseGenC=function(t=-1){for(var e=[],r=[],s=0;s<this.x.length;s++)e[s]=[],r[s]=[],e[s][4]=1,e[s][3]=this.y[s],e[s][2]=this.x[s],e[s][1]=this.x[s]*this.y[s],e[s][0]=this.x[s]*this.x[s],r[s][0]=-this.y[s]*this.y[s];e=new Matrix(e),r=new Matrix(r);for(var i=e.solve(r),a=[],s=0;s<5;s++)s<=1?(a[s]=[],a[s][0]=i.A[s][0]):(a[s+1]=[],a[s+1][0]=i.A[s][0]);return a[2]=[],a[2][0]=1,this.returnEllipse(a,t)},LeastSquares.prototype.ellipseGenD=function(t=-1){for(var e=[],r=[],s=0;s<this.x.length;s++)e[s]=[],r[s]=[],e[s][4]=1,e[s][3]=this.y[s],e[s][2]=this.y[s]*this.y[s],e[s][1]=this.x[s]*this.y[s],e[s][0]=this.x[s]*this.x[s],r[s][0]=-this.x[s];e=new Matrix(e),r=new Matrix(r);for(var i=e.solve(r),a=[],s=0;s<5;s++)s<=2?(a[s]=[],a[s][0]=i.A[s][0]):(a[s+1]=[],a[s+1][0]=i.A[s][0]);return a[3]=[],a[3][0]=1,this.returnEllipse(a,t)},LeastSquares.prototype.ellipseGenE=function(t=-1){for(var e=[],r=[],s=0;s<this.x.length;s++)e[s]=[],r[s]=[],e[s][4]=1,e[s][3]=this.x[s],e[s][2]=this.y[s]*this.y[s],e[s][1]=this.x[s]*this.y[s],e[s][0]=this.x[s]*this.x[s],r[s][0]=-this.y[s];e=new Matrix(e),r=new Matrix(r);for(var i=e.solve(r),a=[],s=0;s<5;s++)s<=3?(a[s]=[],a[s][0]=i.A[s][0]):(a[s+1]=[],a[s+1][0]=i.A[s][0]);return a[4]=[],a[4][0]=1,this.returnEllipse(a,t)},LeastSquares.prototype.ellipseGenF=function(t=-1){for(var e=[],r=[],s=0;s<this.x.length;s++)e[s]=[],r[s]=[],r[s][0]=-1,e[s][4]=this.y[s],e[s][3]=this.x[s],e[s][2]=this.y[s]*e[s][4],e[s][1]=this.x[s]*this.y[s],e[s][0]=this.x[s]*e[s][3];e=new Matrix(e),r=new Matrix(r);for(var i=e.solve(r),a=[],s=0;s<5;s++)a[s]=[],a[s][0]=i.A[s][0];return a[5]=[],a[5][0]=1,this.returnEllipse(a,t)},LeastSquares.prototype.returnEllipse=function(t,e=-1){var r=t[0][0],s=t[1][0],i=t[2][0],a=t[3][0],n=t[4][0],o=s*s,l=r-i,h=r+i,x=i*a,p=s*a,u=s*n,c=r*n,f=o-4*r*i,a=2*((c-p)*n+i*a*a+f*t[5][0]),l=Math.sqrt(l*l+o),o=-Math.sqrt(a*(h+l))/f,h=-Math.sqrt(a*(h-l))/f,u=(2*x-u)/f,p=(2*c-p)/f,f=0,f=0==s?i<r?0:Math.PI:Math.atan(1/s*(i-r-l));return-1!=e&&(e.x_c=u,e.y_c=p,e.a_r=o,e.b_r=h,e.theta=f),new Matrix(t)},LeastSquares.prototype.sphere3D=function(t=-1){for(var e=[],r=[],s=0;s<this.x.length;s++)e[s]=[],r[s]=[],r[s][0]=-1,e[s][8]=this.z[s],e[s][7]=this.y[s],e[s][6]=this.x[s],e[s][5]=this.y[s]*this.z[s],e[s][4]=this.x[s]*this.z[s],e[s][3]=this.x[s]*this.y[s],e[s][2]=this.z[s]*this.z[s],e[s][1]=this.y[s]*this.y[s],e[s][0]=this.x[s]*this.x[s];e=new Matrix(e),r=new Matrix(r);var i=e.solve(r),a=i.A[0][0],n=i.A[1][0],o=i.A[2][0],l=.5*i.A[3][0],h=.5*i.A[4][0],x=.5*i.A[5][0],p=i.A[6][0],u=i.A[7][0],c=i.A[8][0],f=h*h,y=x*x,v=h*x-o*l,g=l*x-n*h,M=l*h-a*x,q=n*a-l*l,w=2*l*h*x+o*q-a*y-n*f,y=-.5*(p*(n*o-y)+u*v+c*g)/w,f=-.5*(p*v+u*(o*a-f)+c*M)/w,q=-.5*(p*g+u*M+c*q)/w,w=[[a,l,h],[l,n,x],[h,x,o]],a=[[y],[f],[q]],w=new Matrix(w),l=(a=new Matrix(a)).transpose(),n=w.times(a),h=l.times(n).A[0][0]-1,x=w.times(1/h).eig(),o=1/Math.sqrt(Math.abs(-x.d[0])),a=1/Math.sqrt(Math.abs(-x.d[1])),l=1/Math.sqrt(Math.abs(-x.d[2])),n=Math.sqrt(1-x.V[2][0]*x.V[2][0]),w=Math.asin(x.V[2][0]),h=Math.atan2(x.V[2][1]/n,x.V[2][2]/n),n=Math.atan2(x.V[1][0]/n,x.V[0][0]/n);return-1!=t&&(t.x_c=y,t.y_c=f,t.z_c=q,t.a_r=o,t.b_r=a,t.c_r=l,t.alpha=n,t.beta=w,t.gamma=h,t.eigV=x.V),i},LeastSquares.runLeastSquaresTest=function(){var t=[.083488725,.972233795,.519432488,.557793421,.300510972,.529587317,.288370293,.295974099,.972950908,.562190618,.485386043,.187655207,.173117839,.401618916,.510703949,.834813425,.913974888,.358703401,.037429811,.809497463,.285912045,.153523603,.966634609,.529821905,.592251179,.710151685,.611030014,.137094865,.619995355,.185711451],e=[.154093159,.560237285,.301702746,.233999395,.319387128,.912314852,.055485191,.131389179,.584452711,.121399731,.478089423,.527552888,.30823643,.401301559,.39393612,.057959329,.429895272,.212793677,.058030451,.128383908,.069685073,.588424668,.129995286,.895030989,.310668533,.286987422,.714797546,.238023745,.842531267,.710897663],r=new LeastSquares(t,e);console.log("x data"),console.log(t),console.log("y data"),console.log(e),console.log("line fit");t=r.line();t.print(5,3),console.log("parabola fit"),(t=r.parab()).print(5,3),console.log("5th degree poly fit"),(t=r.poly(5)).print(5,3),console.log("8th degree poly fit"),(t=r.poly(8)).print(5,3),console.log("Logarithmic fit"),(t=r.log()).print(5,3),console.log("3rd degree exp freq sin fit (10Hz start freq)"),(t=r.sinExpFreq(3,10,2)).print(5,3),console.log("3rd degree exp freq cos fit (10Hz start freq)"),(t=r.cosExpFreq(3,10,2)).print(5,3),console.log("3rd degree exp freq sin-cos fit (10Hz start freq)"),(t=r.sinCosExpFreq(3,10,2)).print(5,3);e=[-4,-3,-2,-1,0,1,2,3,4],r=[-1,0,-1.5,.5,1,-1,-.5,2,-1];console.log("x data"),console.log(e),console.log("y data"),console.log(r);e=new LeastSquares(e,r);console.log("3rd degree linear freq sin fit"),(t=e.sinLinFreq(3)).print(5,3),console.log("3rd degree linear freq cos fit"),(t=e.cosLinFreq(3)).print(5,3),console.log("3rd degree linear freq sin-cos fit"),(t=e.sinCosLinFreq(3)).print(5,3);console.log("Exponential fit (Linear LS)");r=new LeastSquares([1.006,1.666,3.418,3.605,4.562,6.166,7.331,7.642,8.745,9.971,10.924,11.702,12.802,14.339,14.901],[.853,1.625,5.326,4.168,9.873,14.529,21.579,25.018,33.839,45.783,59.037,76.58,94.795,123.343,161.893]);(t=r.expLin()).print(5,3),console.log("Power law fit (Linear LS)"),(t=r.powLin()).print(5,3),console.log("Elliptical Fits");e=new LeastSquares(xElp,yElp);console.log("Ellipse with default, no return parameters (only Ax2+Bxy+Cy2+Dx+Ey+F matrix)"),(t=e.ellipseGen()).print(5,3);r={};t=e.ellipseGen(r,0),console.log("Ellipse parameters (x2 as dependent var)"),console.log("x_c: "+r.x_c+" y_c: "+r.y_c+" a_r: "+r.a_r+" b_r: "+r.b_r+" theta: "+r.theta),t.print(5,3),r={},t=e.ellipseGen(r,1),console.log("Ellipse parameters (xy as dependent var)"),console.log("x_c: "+r.x_c+" y_c: "+r.y_c+" a_r: "+r.a_r+" b_r: "+r.b_r+" theta: "+r.theta),t.print(5,3),r={},t=e.ellipseGen(r,2),console.log("Ellipse parameters (y2 as dependent var)"),console.log("x_c: "+r.x_c+" y_c: "+r.y_c+" a_r: "+r.a_r+" b_r: "+r.b_r+" theta: "+r.theta),t.print(5,3),r={},t=e.ellipseGen(r,3),console.log("Ellipse parameters (x as dependent var)"),console.log("x_c: "+r.x_c+" y_c: "+r.y_c+" a_r: "+r.a_r+" b_r: "+r.b_r+" theta: "+r.theta),t.print(5,3),r={},t=e.ellipseGen(r,4),console.log("Ellipse parameters (y as dependent var)"),console.log("x_c: "+r.x_c+" y_c: "+r.y_c+" a_r: "+r.a_r+" b_r: "+r.b_r+" theta: "+r.theta),t.print(5,3),r={},t=e.ellipseGen(r,5),console.log("Ellipse parameters (Const as dependent var)"),console.log("x_c: "+r.x_c+" y_c: "+r.y_c+" a_r: "+r.a_r+" b_r: "+r.b_r+" theta: "+r.theta),t.print(5,3)},LeastSquares}();Matrix.__class="LeastSquares",Matrix.__interfaces=["java.lang.Cloneable","java.io.Serializable"];